# 5ch風匿名掲示板 機能要件仕様書

## 1. プロジェクト概要

### 1.1 目的
匿名で自由に議論・情報交換ができる掲示板Webサイトを開発する。

### 1.2 コンセプト
- 会員登録不要で誰でも利用可能
- 完全匿名での投稿
- シンプルで軽量なUI/UX
- リアルタイムな情報交換

## 2. 主要機能要件

### 2.1 板（カテゴリ）機能

#### 2.1.1 板一覧表示
- **機能概要**: トップページに全ての板をカテゴリ別に表示
- **表示項目**:
  - 板名
  - 板の説明
  - スレッド数
  - 最終更新日時
- **要件**:
  - カテゴリごとにグループ化して表示
  - 板名クリックでその板のスレッド一覧へ遷移

#### 2.1.2 板の種類（初期実装例）
- ニュース系（ニュース速報、芸能ニュースなど）
- 趣味系（アニメ、ゲーム、スポーツなど）
- 生活系（料理、旅行、ペットなど）
- 技術系（プログラミング、IT、ガジェットなど）

### 2.2 スレッド機能

#### 2.2.1 スレッド一覧表示
- **機能概要**: 選択した板内の全スレッドを一覧表示
- **表示項目**:
  - スレッドタイトル
  - レス数
  - 作成日時
  - 最終投稿日時
- **ソート機能**:
  - 最終投稿日時順（デフォルト）
  - 作成日時順
  - レス数順
- **ページネーション**:
  - 1ページあたり50スレッド表示
- **要件**:
  - スレッドタイトルクリックでスレッド詳細へ遷移
  - 勢いのあるスレッドを視覚的に識別可能

#### 2.2.2 スレッド作成
- **機能概要**: 新規スレッドを立てる
- **入力項目**:
  - スレッドタイトル（必須、1〜100文字）
  - 1レス目の本文（必須、1〜1000文字）
  - 名前欄（任意、デフォルト「名無しさん」、50文字まで）
- **バリデーション**:
  - タイトルの重複チェック（同一板内で同じタイトルは禁止）
  - 連続投稿制限（同一IPから30秒以内の連続スレ立て禁止）
  - 禁止ワードチェック
- **要件**:
  - スレッド作成後、作成したスレッドの詳細ページへ自動遷移
  - スレッド番号（ID）を自動採番

#### 2.2.3 スレッド詳細表示
- **機能概要**: スレッド内の全レスを時系列で表示
- **表示項目**:
  - スレッドタイトル
  - 各レスの情報（レス番号、名前、投稿日時、ID、本文）
  - 総レス数
- **表示方式**:
  - 1ページあたり100レス表示
  - レス番号は1から連番
  - 時系列順に表示（古い順）
- **特殊表示**:
  - URLは自動的にリンク化
  - レスアンカー（>>1など）はリンク化し、クリックで該当レスへジャンプ
  - 画像URLは自動的にサムネイル表示
- **要件**:
  - スレッドが1000レスに達したら自動的に書き込み終了（dat落ち）

### 2.3 レス投稿機能

#### 2.3.1 レス投稿
- **機能概要**: スレッドに返信を投稿
- **入力項目**:
  - 名前欄（任意、デフォルト「名無しさん」、50文字まで）
  - メール欄（任意、50文字まで）
  - 本文（必須、1〜1000文字）
- **特殊機能**:
  - メール欄に「sage」と入力するとスレッドが上がらない
  - レスアンカー（>>123形式）で他のレスを参照可能
- **バリデーション**:
  - 連続投稿制限（同一IPから10秒以内の連続投稿禁止）
  - 同一内容の連続投稿禁止
  - 禁止ワードチェック
  - 本文の文字数チェック
- **要件**:
  - 投稿後は同じスレッドページをリロード
  - レス番号を自動採番
  - 投稿者のIPアドレスからIDを生成（日替わり）

#### 2.3.2 投稿者ID
- **機能概要**: 投稿者の匿名性を保ちつつ、同一人物の投稿を識別
- **生成ロジック**:
  - IPアドレス + 日付 + ソルトをハッシュ化
  - 8文字の英数字で表示（例：AbCd1234）
- **要件**:
  - 日付が変わるとIDも変更
  - 同一スレッド内では同じIDで統一
  - IPアドレスは保存せず、ハッシュのみ保存

### 2.4 検索機能

#### 2.4.1 スレッド検索
- **機能概要**: キーワードでスレッドを検索
- **検索対象**:
  - スレッドタイトル
- **検索条件**:
  - 部分一致
  - 複数キーワードはAND検索
- **表示結果**:
  - スレッド一覧と同じフォーマット
  - 検索にヒットした件数を表示

#### 2.4.2 板内検索
- **機能概要**: 特定の板内でスレッドを検索
- **要件**:
  - 板一覧から板を選択後、その板内のみを検索対象とする

### 2.5 管理機能

#### 2.5.1 禁止ワード管理
- **機能概要**: 投稿を制限するNGワードを管理
- **要件**:
  - 管理者のみアクセス可能
  - 禁止ワードの追加・削除
  - 正規表現対応

#### 2.5.2 スレッド削除
- **機能概要**: 不適切なスレッドを削除
- **要件**:
  - 管理者のみ実行可能
  - 削除理由の記録
  - 削除されたスレッドは完全に非表示

#### 2.5.3 レス削除
- **機能概要**: 不適切なレスを削除
- **要件**:
  - 管理者のみ実行可能
  - 削除されたレスは「このレスは削除されました」と表示
  - レス番号は欠番にならない

#### 2.5.4 アクセス制限
- **機能概要**: 荒らし対策のIP制限
- **要件**:
  - 特定IPアドレスからの投稿を禁止
  - IPレンジでの指定も可能
  - 制限期間の設定（永久、一時的）

## 3. 非機能要件

### 3.1 パフォーマンス
- ページ読み込み時間: 2秒以内（通常の通信環境）
- 同時アクセス数: 1000ユーザー以上に対応
- レスポンス時間: 投稿後のリロードは3秒以内

### 3.2 可用性
- 稼働率: 99%以上
- メンテナンス時間: 月1回、深夜帯に実施

### 3.3 セキュリティ
- XSS（クロスサイトスクリプティング）対策
- SQLインジェクション対策
- CSRF（クロスサイトリクエストフォージェリ）対策
- DDoS攻撃への対策
- 個人情報の非保存（IPアドレスはハッシュ化のみ）

### 3.4 スケーラビリティ
- データベースの水平分割に対応
- キャッシュ機構の導入
- CDNの利用を想定

### 3.5 ユーザビリティ
- レスポンシブデザイン（スマートフォン対応）
- シンプルで直感的なUI
- アクセシビリティへの配慮

### 3.6 ブラウザ対応
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）
- スマートフォンブラウザ（iOS Safari、Chrome for Android）

## 4. データ設計概要

### 4.1 主要エンティティ

#### 板（Board）
- ID
- 板名
- 説明
- カテゴリ
- 作成日時

#### スレッド（Thread）
- ID
- 板ID
- タイトル
- レス数
- 作成日時
- 最終投稿日時
- ステータス（アクティブ/dat落ち/削除済み）

#### レス（Post）
- ID
- スレッドID
- レス番号
- 名前
- メール
- 投稿日時
- 投稿者ID（ハッシュ）
- 本文
- 削除フラグ

#### 禁止ワード（BannedWord）
- ID
- ワード/正規表現
- 登録日時

#### アクセス制限（IPBan）
- ID
- IPアドレス/範囲
- 制限開始日時
- 制限終了日時（nullの場合は永久）
- 理由

## 5. 画面一覧

### 5.1 トップページ（板一覧）
- URL: `/`
- 全ての板をカテゴリ別に表示

### 5.2 板トップページ（スレッド一覧）
- URL: `/board/{board_id}/`
- 選択した板のスレッド一覧を表示

### 5.3 スレッド詳細ページ
- URL: `/board/{board_id}/thread/{thread_id}/`
- スレッド内の全レスを表示
- 投稿フォームを表示

### 5.4 スレッド作成ページ
- URL: `/board/{board_id}/new/`
- 新規スレッド作成フォーム

### 5.5 検索結果ページ
- URL: `/search/?q={keyword}`
- 検索結果のスレッド一覧を表示

### 5.6 管理画面（管理者のみ）
- URL: `/admin/`
- 禁止ワード管理
- スレッド/レス削除
- アクセス制限管理

## 6. 技術要件

### 6.1 推奨技術スタック

#### フロントエンド
- HTML5, CSS3
- JavaScript（バニラまたはシンプルなフレームワーク）
- レスポンシブデザイン

#### バックエンド
- Python（Flask/Django）、Node.js（Express）、またはRuby（Rails）
- RESTful API設計

#### データベース
- PostgreSQL または MySQL
- Redisなどのキャッシュ

#### インフラ
- Docker対応
- クラウドホスティング（AWS, GCP, Azureなど）

### 6.2 開発環境
- Git によるバージョン管理
- CI/CD パイプライン
- テスト環境・本番環境の分離

## 7. 制約事項

### 7.1 機能制約
- 画像アップロード機能は初期バージョンでは非対応（URL貼り付けのみ）
- ユーザー認証機能なし（完全匿名）
- プライベートメッセージ機能なし
- 通知機能なし

### 7.2 法的制約
- 違法コンテンツの投稿禁止
- 著作権侵害の投稿禁止
- 個人情報の投稿禁止
- 利用規約への同意が必要

## 8. 今後の拡張案

### 8.1 Phase 2（将来的な実装）
- 画像アップロード機能
- スレッドのお気に入り登録（ローカルストレージ）
- レスの引用機能強化
- スレッドの自動アーカイブ機能

### 8.2 Phase 3（さらなる拡張）
- モバイルアプリ化
- リアルタイム更新（WebSocket）
- APIの公開
- 多言語対応

## 9. 開発スケジュール概要

### Phase 1: 基本機能実装（1〜2ヶ月）
- データベース設計・構築
- 板・スレッド・レス機能の実装
- 基本的なUI/UXの実装

### Phase 2: セキュリティ・管理機能（1ヶ月）
- セキュリティ対策の実装
- 管理機能の実装
- テスト・バグ修正

### Phase 3: パフォーマンス最適化・リリース準備（2週間）
- パフォーマンスチューニング
- 負荷テスト
- ドキュメント整備

## 10. 運用・保守

### 10.1 監視項目
- サーバーの稼働状況
- アクセス数・トラフィック
- エラーログ
- データベースのパフォーマンス

### 10.2 バックアップ
- データベースの日次バックアップ
- バックアップデータの保存期間: 30日間

### 10.3 更新・メンテナンス
- セキュリティパッチの適用
- 機能追加・改善
- バグ修正

---

**バージョン**: 1.0  
**作成日**: 2026年1月8日  
**最終更新**: 2026年1月8日
